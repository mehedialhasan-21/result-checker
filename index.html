<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Akota Kinder Garten Result Checker</title>

<!-- Bootstrap -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- Google Font -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

<!-- Custom CSS -->
<style>
/* =====================
   GLOBAL
===================== */
:root {
  --primary: #4f46e5;
  --secondary: #06b6d4;
  --success: #16a34a;
  --danger: #dc2626;
  --light: #f8fafc;
  --dark: #0f172a;
}

body {
  font-family: 'Poppins', sans-serif;
  background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
  min-height: 100vh;
  padding: 20px 0;
}

/* =====================
   RESULT CARD (GLASS)
===================== */
.result-card {
  background: rgba(15, 23, 42, 0.85);
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 25px;
  color: white;
  width: 100%;
  max-width: 520px;
  padding: 30px;
  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
  animation: slideUp 0.6s ease;
}

@keyframes slideUp {
  from {opacity:0; transform: translateY(20px);}
  to {opacity:1; transform: translateY(0);}
}

/* =====================
   FORM CONTROLS
===================== */
.form-control, select {
  border-radius: 14px;
  padding: 12px;
  border: 1px solid rgba(255, 255, 255, 0.1);
  font-weight: 500;
  background: rgba(255, 255, 255, 0.05);
  color: white;
  transition: all 0.3s;
}

.form-control::placeholder {
  color: rgba(255, 255, 255, 0.5);
}

.form-control:focus {
  box-shadow: 0 0 0 3px rgba(79,70,229,0.35);
  background: rgba(255, 255, 255, 0.08);
  border-color: var(--primary);
  color: white;
}

select option {
  background: #1e293b;
  color: white;
}

/* =====================
   BUTTON
===================== */
.btn-primary {
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  border: none;
  padding: 14px;
  border-radius: 14px;
  font-weight: 600;
  letter-spacing: .4px;
  transition: .3s;
  font-size: 16px;
}

.btn-primary:hover {
  transform: translateY(-2px);
  box-shadow: 0 10px 25px rgba(0,0,0,.4);
}

/* =====================
   ALERTS
===================== */
.alert {
  border-radius: 14px;
  border: none;
}

/* =====================
   MARKSHEET
===================== */
.marksheet {
  font-family: 'Poppins', 'Segoe UI', sans-serif;
  background: white;
  color: black;
  padding: 25px;
  border-radius: 18px;
  box-shadow: 0 10px 30px rgba(0,0,0,.2);
  animation: fadeIn .4s ease;
}

@keyframes fadeIn {
  from {opacity:0; transform: scale(.97);}
  to {opacity:1;}
}

/* =====================
   HEADERS
===================== */
.marksheet h4 {
  font-weight: 700;
  color: var(--primary);
  letter-spacing: .5px;
  margin-bottom: 10px;
}

.marksheet h5 {
  font-weight: 600;
  color: #8b0000;
  margin-bottom: 20px;
  border-bottom: 2px solid #e0e7ff;
  padding-bottom: 10px;
}

/* =====================
   INFO ROWS
===================== */
.info-row {
  display: flex;
  flex-wrap: wrap;
  gap: 15px;
  font-size: 14px;
  margin-bottom: 20px;
  padding: 15px;
  background: #f8fafc;
  border-radius: 12px;
}

.info-row span {
  background: white;
  padding: 6px 12px;
  border-radius: 8px;
  border: 1px solid #e2e8f0;
  display: inline-flex;
  align-items: center;
  gap: 5px;
}

/* =====================
   STATUS BADGES
===================== */

/* =====================
   TABLE
===================== */
.table {
  border-radius: 12px;
  overflow: hidden;
  margin-top: 20px;
  font-size: 15px;
  border: 1px solid #e2e8f0;
}

.table th {
  background: #e0e7ff;
  color: #1e293b;
  text-align: center;
  font-weight: 600;
  padding: 12px;
}

.table td {
  text-align: center;
  padding: 12px;
  border-bottom: 1px solid #e2e8f0;
}

.table tbody tr:hover {
  background: #f8fafc;
}

/* =====================
   TOTAL ROW
===================== */
.table tfoot tr {
  background: #eef2ff;
  font-weight: 700;
}

.table tfoot th {
  background: #d1d9ff;
}

/* =====================
   GPA & DATE
===================== */
.gpa-row {
  display: flex;
  justify-content: space-between;
  margin-top: 20px;
  font-size: 17px;
  padding: 15px;
  background: #f1f5f9;
  border-radius: 12px;
}

.footer-row {
  display: flex;
  justify-content: space-between;
  margin-top: 20px;
  font-size: 14px;
  color: #475569;
  border-top: 1px solid #e2e8f0;
  padding-top: 15px;
}

/* =====================
   COMPARE SECTION
===================== */
#compareSection {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 16px;
  padding: 20px;
  margin-top: 20px;
  color: black;
}

.compare-card {
  background: white;
  border-radius: 16px;
  padding: 20px;
  box-shadow: 0 10px 25px rgba(0,0,0,.15);
}

.compare-card h6 {
  font-weight: 700;
  text-align: center;
  margin-bottom: 20px;
  color: var(--primary);
}

.compare-table th {
  background: #eef2ff;
  text-align: center;
}

.compare-table td {
  text-align: center;
  font-weight: 500;
}

/* =====================
   PRINT MODE
===================== */
@media print {
  body {
    background: white;
    padding: 0;
  }

  .result-card {
    box-shadow: none;
    background: white;
    color: black;
    max-width: 100%;
    padding: 0;
  }

  .btn, .mb-3, .mb-4, #compareSection, hr {
    display: none !important;
  }
  
  .marksheet {
    box-shadow: none;
    padding: 0;
  }
}

/* =====================
   RESPONSIVE
===================== */
@media (max-width: 576px) {
  .result-card {
    padding: 20px 15px;
  }
  
  .info-row {
    gap: 10px;
  }
  
  .gpa-row, .footer-row {
    flex-direction: column;
    gap: 10px;
  }
  
  .table {
    font-size: 14px;
  }
  
  .table th, .table td {
    padding: 8px 5px;
  }
}
</style>
</head>

<body>

<div class="container d-flex justify-content-center align-items-center">
  <div class="result-card">
    <!-- ===== HEADER ===== -->
    <div class="text-center mb-4">
      <h3 class="fw-bold">Akota Kinder Garten and<br>Pre-Cadet School</h3>
      <p class="text-light mb-2">Official Online Result Portal</p>
      <span class="badge bg-warning text-dark fs-6">Academic Year 2026</span>
    </div>

    <!-- ===== FORM ===== -->
    <div class="mb-3">
      <label class="form-label text-light">Select Class</label>
      <select id="classSelect" class="form-control">
        <option value="">-- Select Class --</option>
        <option value="1">Class 1</option>
        <option value="2">Class 2</option>
        <option value="3">Class 3</option>
        <option value="4">Class 4</option>
        <option value="5">Class 5</option>
      </select>
    </div>

    <div class="mb-3">
      <label class="form-label text-light">Exam Term</label>
      <select id="termSelect" class="form-control">
        <option value="">-- Select Term --</option>
        <option value="1st">1st Term</option>
        <option value="2nd">2nd Term</option>
        <option value="Final">Final Exam</option>
      </select>
    </div>

    <div class="mb-4">
      <label class="form-label text-light">Roll Number</label>
      <input type="number" id="rollInput" class="form-control" placeholder="Enter student roll" min="1">
    </div>

    <!-- ===== BUTTON ===== -->
    <button class="btn btn-primary w-100 fw-semibold mb-3" onclick="checkResult()">
      Check Result
    </button>
    


    <!-- ===== RESULT OUTPUT ===== -->
    <div id="result" class="mt-4"></div>
    <br>
        <!-- ===== PRINT BUTTON ===== -->
    <button class="btn btn-outline-light w-100 fw-semibold mb-4" onclick="window.print()" id="printBtn" style="display: none;">
      Print Result
    </button>

    <hr class="my-4 border-light">

    <!-- ===== SHOW/HIDE COMPARE SECTION ===== -->
    <div class="mb-3 text-center">
      <button class="btn btn-warning w-100 fw-semibold" id="showCompareBtn">
        Compare Students
      </button>
    </div>
    
    <!-- ===== COMPARE SECTION (HIDDEN INITIALLY) ===== -->
    <div id="compareSection" style="display:none;">
      <h5 class="text-light text-center mb-3">Compare Two Students</h5>

      <div class="row mb-3">
        <div class="col">
          <input type="number" id="rollCompare1" class="form-control" placeholder="Enter Roll 1" min="1">
        </div>
        <div class="col">
          <input type="number" id="rollCompare2" class="form-control" placeholder="Enter Roll 2" min="1">
        </div>
      </div>

      <div class="mb-3">
        <button class="btn btn-success w-100 fw-semibold" onclick="compareStudents()">
          Compare Students
        </button>
      </div>

      <div id="compareResult" class="mt-3"></div>
    </div>

    <!-- ===== FOOTER ===== -->
    <div class="text-center mt-4 pt-3 border-top border-light">
      <small class="text-light opacity-75">
        Â© 2026 â€¢ Powered by Mehedi Al Hasan Sawon
      </small>
    </div>
  </div>
</div>

<script>
// Sample data structure - Replace with your actual Google Sheets CSV links
const sheetLinks = {
  1: "https://docs.google.com/spreadsheets/d/e/2PACX-1vRzQfWwhLQUAANvI90FSIrTYe9UWVdamvanJHWhJ0NqFnNsvIhD1mTDBhDT6kaoCHOpJL_Iqlfoe-Ra/pub?gid=0&single=true&output=csv",
  2: "PASTE_CLASS2_CSV_LINK",
  3: "PASTE_CLASS3_CSV_LINK",
  4: "PASTE_CLASS4_CSV_LINK",
  5: "PASTE_CLASS5_CSV_LINK"
};

async function checkResult() {
  const cls = document.getElementById("classSelect").value;
  const term = document.getElementById("termSelect").value;
  const roll = document.getElementById("rollInput").value;
  const resultDiv = document.getElementById("result");
  const printBtn = document.getElementById("printBtn");

  // Clear previous results and hide print button
  resultDiv.innerHTML = '';
  printBtn.style.display = 'none';

  // Validation
  if (!cls || !term || !roll) {
    resultDiv.innerHTML = `<div class="alert alert-danger alert-dismissible fade show">
      <strong>Error!</strong> Please fill all the required fields.
      <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>`;
    return;
  }

  if (roll <= 0) {
    resultDiv.innerHTML = `<div class="alert alert-warning">Please enter a valid roll number.</div>`;
    return;
  }

  // Show loading
  resultDiv.innerHTML = `<div class="text-center">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="text-light mt-2">Fetching result...</p>
  </div>`;

  try {
    // Fetch data from Google Sheets
    const res = await fetch(sheetLinks[cls]);
    if (!res.ok) throw new Error('Failed to fetch data');
    
    const text = await res.text();
    const rows = text.trim().split("\n").slice(1);

    let studentSubjects = [];
    let studentInfo = null;
    let fail = false;
    let subjectHighest = {};
    let studentTotals = {};

    // Process each row
    rows.forEach(r => {
      const c = r.split(",");
      if (c.length < 8) return; // Skip invalid rows
      
      const rRoll = c[0].trim();
      const rTerm = c[5].trim();
      const subject = c[6].trim();
      const marks = Number(c[7].trim());

      if (rTerm !== term) return;

      // Highest marks calculation
      subjectHighest[subject] = Math.max(subjectHighest[subject] || 0, marks);

      // Total marks calculation
      studentTotals[rRoll] = (studentTotals[rRoll] || 0) + marks;

      // Current student
      if (rRoll == roll) {
        studentInfo = c;
        studentSubjects.push({ subject, marks });
        if (marks < 33) fail = true;
      }
    });

    if (!studentInfo || studentSubjects.length === 0) {
      resultDiv.innerHTML = `<div class="alert alert-warning">
        <strong>Not Found!</strong> No result found for Roll ${roll} in ${term} Term.
      </div>`;
      return;
    }

    // Position calculation
    const sortedTotals = Object.entries(studentTotals)
      .sort((a, b) => b[1] - a[1])
      .map(x => x[0]);

    const position = fail ? "--" : sortedTotals.indexOf(roll) + 1;
    const totalMarks = studentSubjects.reduce((s, x) => s + x.marks, 0);
    const totalSubjects = studentSubjects.length;
    const gpa = fail ? "0.00 (Fail)" : (totalMarks / totalSubjects / 20).toFixed(2);
    const status = fail ? "Fail" : "Pass";
    const percentage = ((totalMarks / (totalSubjects * 100)) * 100).toFixed(2);
    const highestTotal = Math.max(...Object.values(studentTotals));

let topperRoll = null;
let topperName = "N/A";

rows.forEach(r => {
  const c = r.split(",");
  if (c.length < 8 || c[5].trim() !== term) return;

  const rRoll = c[0].trim();

  if (studentTotals[rRoll] === highestTotal) {
    topperRoll = rRoll;
    topperName = c[1] || "N/A"; // student name column
  }
});

    // Build table rows
    let tableRows = "";
    studentSubjects.forEach(s => {
      const isFail = s.marks < 33;
      tableRows += `
        <tr>
          <td>${s.subject}</td>
          <td>100</td>
          <td>${subjectHighest[s.subject]}</td>
          <td class="${isFail ? 'text-danger fw-bold' : ''}">${s.marks}${isFail ? ' (Fail)' : ''}</td>
        </tr>`;
    });

    // Display result
    resultDiv.innerHTML = `
    <div class="marksheet">
      <h4 class="text-center">Akota Kinder Garten Pre-Cadet School</h4>
      <h5 class="text-center">Academic Marksheet - 2026</h5>

      <div class="student-info">
        <p><b>Name:</b> ${studentInfo[1] || 'N/A'}</p>
        <p><b>Father's Name:</b> ${studentInfo[2] || 'N/A'}</p>
        <p><b>Mother's Name:</b> ${studentInfo[3] || 'N/A'}</p>
      </div>

      <div class="info-row">
        <span><b>Class:</b> ${cls}</span>
        <span><b>Roll:</b> ${roll}</span>
        <span><b>Term:</b> ${term}</span>
        <span><b>Status:</b> ${status}</span>
        <span class="text-success fw-bold">
    ðŸ¥‡ Position 1: ${topperName} (Roll ${topperRoll})
  </span>
      </div>
<span><b>Position:</b> ${position}</span>
      <table class="table table-bordered">
        <thead>
          <tr>
            <th>Subject</th>
            <th>Total</th>
            <th>Highest</th>
            <th>Obtained</th>
          </tr>
        </thead>
        <tbody>
          ${tableRows}
        </tbody>
        <tfoot>
          <tr>
            <th>Total</th>
            <th>${totalSubjects * 100}</th>
            <th>${highestTotal}</th>
            <th>${totalMarks}</th>
          </tr>
        </tfoot>
      </table>

      <div class="gpa-row">
        <span class="${fail ? 'text-danger' : 'text-success'}"><b>GPA:</b> ${gpa}</span>
        <span class="text-primary"><b>Percentage:</b> ${percentage}%</span>
      </div>

      <div class="footer-row">
        <span><b>Date:</b> ${new Date().toLocaleDateString('en-GB')}</span>
        <span><b>Verified By:</b> Principal</span>
      </div>
    </div>`;

    // Show print button
    printBtn.style.display = 'block';

  } catch (error) {
    console.error('Error:', error);
    resultDiv.innerHTML = `<div class="alert alert-danger">
      <strong>Error!</strong> Failed to load results. Please check your connection or contact support.
    </div>`;
  }
}

async function compareStudents() {
  const cls = document.getElementById("classSelect").value;
  const term = document.getElementById("termSelect").value;
  const roll1 = document.getElementById("rollCompare1").value;
  const roll2 = document.getElementById("rollCompare2").value;
  const compareDiv = document.getElementById("compareResult");

  // Validation
  if (!cls || !term || !roll1 || !roll2) {
    compareDiv.innerHTML = `<div class="alert alert-danger">Please fill all fields for comparison</div>`;
    return;
  }

  if (roll1 === roll2) {
    compareDiv.innerHTML = `<div class="alert alert-warning">Please enter two different roll numbers</div>`;
    return;
  }

  compareDiv.innerHTML = `<div class="text-center">
    <div class="spinner-border text-success" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>`;

  try {
    const res = await fetch(sheetLinks[cls]);
    const text = await res.text();
    const rows = text.trim().split("\n").slice(1);

    let student1 = { info: {}, marks: {} };
    let student2 = { info: {}, marks: {} };
    let subjectsSet = new Set();

    rows.forEach(r => {
      const c = r.split(",");
      if (c.length < 8 || c[5].trim() !== term) return;
      
      const subject = c[6].trim();
      const marks = Number(c[7].trim());
      subjectsSet.add(subject);

      if (c[0].trim() == roll1) {
        student1.info = c;
        student1.marks[subject] = marks;
      }
      if (c[0].trim() == roll2) {
        student2.info = c;
        student2.marks[subject] = marks;
      }
    });

    if (!Object.keys(student1.marks).length || !Object.keys(student2.marks).length) {
      compareDiv.innerHTML = `<div class="alert alert-warning">One or both students not found</div>`;
      return;
    }

    // Build comparison table
    let tableRows = "";
    let total1 = 0;
    let total2 = 0;

    subjectsSet.forEach(sub => {
      const m1 = student1.marks[sub] || 0;
      const m2 = student2.marks[sub] || 0;
      total1 += m1;
      total2 += m2;

      let s1Class = m1 > m2 ? "table-success" : m1 < m2 ? "table-danger" : "";
      let s2Class = m2 > m1 ? "table-success" : m2 < m1 ? "table-danger" : "";

      tableRows += `
        <tr>
          <td>${sub}</td>
          <td class="${s1Class}">${m1}</td>
          <td class="${s2Class}">${m2}</td>
        </tr>`;
    });
let position1, position2;

if (total1 > total2) {
  position1 = 1;
  position2 = 2;
} else if (total2 > total1) {
  position1 = 2;
  position2 = 1;
} else {
  position1 = position2 = "Tie";
}
    // Determine winner
    let winnerText = "";
    if (total1 > total2) {
      winnerText = `<span class="badge bg-success">Roll ${roll1} Wins!</span>`;
    } else if (total2 > total1) {
      winnerText = `<span class="badge bg-success">Roll ${roll2} Wins!</span>`;
    } else {
      winnerText = `<span class="badge bg-info">It's a Tie!</span>`;
    }

    compareDiv.innerHTML = `
    <div class="compare-card">
      <h6 class="text-center mb-3">Student Comparison Result</h6>
      <div class="text-center mb-3">${winnerText}</div>
      
<div class="row mb-3">
  <div class="col text-center">
    <strong>Roll ${roll1}:</strong> ${student1.info[1] || 'N/A'}<br>
    <span class="text-primary">Total: ${total1}</span><br>
    <span><b>Position:</b> ${position1}</span>
  </div>

  <div class="col text-center">
    <strong></strong> ${student2.info[1] || 'N/A'}<br>
    <span class="text-primary">Total: ${total2}</span><br>
    <span><b>Position:</b> ${position2}</span>
  </div>
</div>

      <table class="table table-bordered compare-table">
        <thead>
          <tr>
            <th>Subject</th>
            <th>Roll ${roll1}</th>
            <th>Roll ${roll2}</th>
          </tr>
        </thead>
        <tbody>
          ${tableRows}
          <tr class="table-active">
            <th>Total</th>
            <th>${total1}</th>
            <th>${total2}</th>
          </tr>
        </tbody>
      </table>
    </div>`;

  } catch (error) {
    compareDiv.innerHTML = `<div class="alert alert-danger">Error loading comparison data</div>`;
  }
}

// Show/Hide Compare Section
document.getElementById("showCompareBtn").addEventListener("click", function() {
  const section = document.getElementById("compareSection");
  if (section.style.display === "none") {
    section.style.display = "block";
    this.innerText = "Hide Compare Section";
    this.classList.remove("btn-warning");
    this.classList.add("btn-danger");
  } else {
    section.style.display = "none";
    this.innerText = "Compare Students";
    this.classList.remove("btn-danger");
    this.classList.add("btn-warning");
    document.getElementById("compareResult").innerHTML = "";
  }
});

// Add enter key support
document.getElementById("rollInput").addEventListener("keypress", function(e) {
  if (e.key === "Enter") checkResult();
});

document.getElementById("rollCompare2").addEventListener("keypress", function(e) {
  if (e.key === "Enter") compareStudents();
});
</script>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
