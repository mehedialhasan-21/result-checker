<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Akota Kinder Garten Result Checker</title>

<!-- Bootstrap -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- Google Font -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<!-- Custom CSS -->
<style>
/* =====================
   GLOBAL
===================== */
:root {
  --primary: #4f46e5;
  --primary-dark: #4338ca;
  --secondary: #06b6d4;
  --success: #10b981;
  --danger: #ef4444;
  --warning: #f59e0b;
  --light: #f8fafc;
  --dark: #0f172a;
  --dark-light: #1e293b;
  --glass-bg: rgba(15, 23, 42, 0.85);
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Poppins', sans-serif;
  background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
  min-height: 100vh;
  color: var(--light);
}

/* =====================
   CONTAINER (DESKTOP ONLY PADDING)
===================== */
@media (min-width: 992px) {
  .container {
    padding: 20px 15px;
    max-width: 1000px;
    margin: 0 auto;
  }
}

/* =====================
   RESULT CARD (GLASS)
===================== */
.result-card {
  border: none;
  animation: slideUp 0.6s ease-out;
  position: relative;
  overflow: hidden;
}

/* Desktop padding */
@media (min-width: 992px) {
  .result-card {
    padding: 30px;
  }
}

.result-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
}

@keyframes slideUp {
  from { opacity: 0; transform: translateY(30px); }
  to { opacity: 1; transform: translateY(0); }
}

/* =====================
   HEADER
===================== */
.header {
  text-align: center;
  margin-bottom: 30px;
  position: relative;
}

/* Mobile header adjustments */
@media (max-width: 991px) {
  .header {
    margin-bottom: 20px;
    padding: 0 15px;
  }
  
  .header h3 {
    font-size: 1.9rem !important;
    line-height: 1.3;
  }
}

.header h3 {
  font-weight: 700;
  font-size: 1.9rem;
  color: white;
  margin-bottom: 5px;
}

.header p {
  font-weight: 300;
  opacity: 0.9;
  margin-bottom: 15px;
}

.badge-academic {
  background: linear-gradient(90deg, #f59e0b, #f97316);
  border: none;
  font-weight: 600;
  padding: 8px 20px;
  border-radius: 50px;
  box-shadow: 0 4px 15px rgba(245, 158, 11, 0.2);
}

/* =====================
   FORM CONTROLS
===================== */
.form-label {
  font-weight: 500;
  margin-bottom: 8px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.form-label i {
  color: var(--secondary);
}

.form-control, select {
  border-radius: 14px;
  padding: 14px 18px;
  border: 1px solid rgba(255, 255, 255, 0.15);
  font-weight: 500;
  background: rgba(255, 255, 255, 0.07);
  color: white;
  transition: all 0.3s ease;
  font-size: 15px;
}

/* Mobile form spacing */
@media (max-width: 991px) {
  .form-control, select {
    padding: 12px 15px;
  }
  
  .mb-4 {
    margin-bottom: 15px !important;
    padding: 0 15px;
  }
}

.form-control::placeholder {
  color: rgba(255, 255, 255, 0.5);
}

.form-control:focus, select:focus {
  box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.4);
  background: rgba(255, 255, 255, 0.1);
  border-color: var(--primary);
  color: white;
  outline: none;
}

select option {
  background: var(--dark-light);
  color: white;
  padding: 10px;
}

/* =====================
   BUTTONS
===================== */
.btn-primary {
  background: linear-gradient(135deg, var(--primary), var(--primary-dark));
  border: none;
  padding: 16px;
  border-radius: 14px;
  font-weight: 600;
  letter-spacing: .5px;
  transition: all 0.3s ease;
  font-size: 16px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  box-shadow: 0 8px 20px rgba(79, 70, 229, 0.3);
}

/* Mobile button spacing */
@media (max-width: 991px) {
  .btn-primary, .btn-outline-light, .btn-warning, .btn-success, .btn-danger {
    padding: 14px;
    margin: 0 15px;
    width: calc(100% - 30px) !important;
  }
}

.btn-primary:hover {
  transform: translateY(-3px);
  box-shadow: 0 12px 25px rgba(79, 70, 229, 0.4);
  background: linear-gradient(135deg, var(--primary-dark), var(--primary));
}

.btn-outline-light {
  border: 2px solid rgba(255, 255, 255, 0.2);
  padding: 14px;
  border-radius: 14px;
  font-weight: 600;
  transition: all 0.3s;
}

.btn-outline-light:hover {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(255, 255, 255, 0.4);
  transform: translateY(-2px);
}

.btn-warning {
  background: linear-gradient(135deg, var(--warning), #eab308);
  border: none;
  padding: 14px;
  border-radius: 14px;
  font-weight: 600;
  transition: all 0.3s;
}

.btn-warning:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(245, 158, 11, 0.3);
}

.btn-success {
  background: linear-gradient(135deg, var(--success), #059669);
  border: none;
  padding: 14px;
  border-radius: 14px;
  font-weight: 600;
  transition: all 0.3s;
}

.btn-success:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(16, 185, 129, 0.3);
}

.btn-danger {
  background: linear-gradient(135deg, var(--danger), #dc2626);
  border: none;
  padding: 14px;
  border-radius: 14px;
  font-weight: 600;
  transition: all 0.3s;
}

.btn-danger:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(239, 68, 68, 0.3);
}

/* =====================
   ALERTS
===================== */
.alert {
  border-radius: 14px;
  border: none;
  padding: 16px;
  font-weight: 500;
}

.alert-dismissible .btn-close {
  filter: brightness(0) invert(1);
}

/* =====================
   MARKSHEET
===================== */
.marksheet {
  font-family: Monospace;
  background: white;
  color: var(--dark);
  border-radius: 20px;
  box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
  animation: fadeIn 0.5s ease-out;
  position: relative;
  overflow: hidden;
}

/* Mobile marksheet adjustments */
@media (max-width: 991px) {
  .marksheet {
    margin: 0 10px;
    padding: 15px !important;
    border-radius: 15px;
  }
}

.marksheet::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 8px;
  height: 100%;
  background: linear-gradient(to bottom, var(--primary), var(--secondary));
}

@keyframes fadeIn {
  from { opacity: 0; transform: scale(0.95); }
  to { opacity: 1; transform: scale(1); }
}

.marksheet h4 {
  font-weight: 700;
  color: var(--primary);
  text-align: center;
  margin-bottom: 10px;
  font-size: 1.5rem;
}

/* Mobile heading adjustments */
@media (max-width: 991px) {
  .marksheet h4 {
    font-size: 1.2rem;
  }
  
  .marksheet h5 {
    font-size: 1rem;
    margin-bottom: 15px;
    padding-bottom: 10px;
  }
}

.marksheet h5 {
  font-weight: 600;
  color: var(--danger);
  text-align: center;
  margin-bottom: 25px;
  border-bottom: 2px solid #e0e7ff;
  padding-bottom: 15px;
  font-size: 1.2rem;
}

/* =====================
   STUDENT INFO
===================== */
.student-info {
  background: #f8fafc;
  padding: 20px;
  border-radius: 12px;
  margin-bottom: 20px;
  border-left: 4px solid var(--primary);
}

@media (max-width: 991px) {
  .student-info {
    padding: 5px;
    margin-bottom: 15px;
  }
  
  .student-info p {
    margin-bottom: 6px;
    font-size: 14px;
  }
}

.student-info p {
  margin-bottom: 8px;
  font-size: 15px;
}

.student-info b {
  color: var(--dark);
  min-width: 140px;
  display: inline-block;
}

/* =====================
   INFO ROWS
===================== */
.info-row {
  display: flex;
  flex-wrap: wrap;
  gap: 15px;
  font-size: 14px;
  margin-bottom: 25px;
  padding: 18px;
  background: #f1f5f9;
  border-radius: 12px;
  align-items: center;
}

@media (max-width: 991px) {
  .info-row {
    padding: 12px;
    margin-bottom: 15px;
    gap: 10px;
  }
  
  .info-row span {
    padding: 6px 12px;
    font-size: 13px;
  }
}

.info-row span {
  background: white;
  padding: 8px 16px;
  border-radius: 8px;
  border: 1px solid #e2e8f0;
  display: inline-flex;
  align-items: center;
  gap: 8px;
  font-weight: 500;
  box-shadow: 0 2px 5px rgba(0,0,0,0.05);
}

.info-row span b {
  color: var(--primary);
}

/* =====================
   STATUS BADGES
===================== */
.badge-status {
  padding: 6px 14px;
  border-radius: 50px;
  font-weight: 600;
  font-size: 13px;
}

.badge-pass {
  background: rgba(16, 185, 129, 0.15);
  color: var(--success);
}

.badge-fail {
  background: rgba(239, 68, 68, 0.15);
  color: var(--danger);
}

.badge-position {
  background: gold;
  color: black;
  font-weight: bold;
  padding: 6px 14px;
  border-radius: 20px;
  border: 2px solid blue;
  font-size: 15px;
}

/* =====================
   TABLE
===================== */
.table {
  border-radius: 12px;
  overflow: hidden;
  margin-top: 20px;
  font-size: 15px;
  border: 1px solid #e2e8f0;
  box-shadow: 0 5px 15px rgba(0,0,0,0.05);
}

@media (max-width: 991px) {
  .table {
    margin-top: 15px;
    font-size: 14px;
  }
  
  .table th, .table td {
    padding: 10px 8px !important;
  }
}

.table th {
  background: #e0e7ff;
  color: #1e293b;
  text-align: center;
  font-weight: 600;
  padding: 14px;
  border-bottom: 2px solid #c7d2fe;
}

.table td {
  text-align: center;
  padding: 14px;
  border-bottom: 1px solid #e2e8f0;
  vertical-align: middle;
}

.table tbody tr:hover {
  background: #f8fafc;
}

/* =====================
   TABLE FOOTER
===================== */
.table tfoot tr {
  background: #eef2ff;
  font-weight: 700;
}

.table tfoot th {
  background: #d1d9ff;
  font-size: 16px;
}

/* =====================
   GPA & PERCENTAGE
===================== */
.gpa-row {
  display: flex;
  justify-content: space-between;
  margin-top: 25px;
  font-size: 17px;
  padding: 18px;
  background: #f1f5f9;
  border-radius: 12px;
  align-items: center;
}

@media (max-width: 991px) {
  .gpa-row {
    flex-direction: column;
    gap: 10px;
    align-items: flex-start;
    padding: 15px;
    margin-top: 15px;
    font-size: 15px;
  }
}

.gpa-row span {
  display: flex;
  align-items: center;
  gap: 10px;
  font-weight: 600;
}

.gpa-pass {
  color: var(--success);
}

.gpa-fail {
  color: var(--danger);
}

/* =====================
   FOOTER ROW
===================== */
.footer-row {
  display: flex;
  justify-content: space-between;
  margin-top: 25px;
  font-size: 14px;
  color: #64748b;
  border-top: 1px solid #e2e8f0;
  padding-top: 20px;
}

@media (max-width: 991px) {
  .footer-row {
    flex-direction: column;
    gap: 10px;
    margin-top: 15px;
    padding-top: 15px;
    font-size: 13px;
  }
}

.footer-row span {
  display: flex;
  align-items: center;
  gap: 8px;
}

/* =====================
   COMPARE SECTION
===================== */
#compareSection {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 18px;
  padding: 25px;
  margin-top: 25px;
  border: 1px solid rgba(255, 255, 255, 0.1);
  animation: fadeIn 0.4s ease;
}

@media (max-width: 991px) {
  #compareSection {
    padding: 15px;
    margin: 0 10px;
    margin-top: 20px;
  }
  
  .compare-card {
    padding: 15px !important;
  }
}

.compare-card {
  background: white;
  border-radius: 16px;
  padding: 25px;
  box-shadow: 0 10px 25px rgba(0,0,0,0.1);
  animation: slideUp 0.4s ease;
}

.compare-card h6 {
  font-weight: 700;
  text-align: center;
  margin-bottom: 20px;
  color: var(--primary);
  font-size: 1.1rem;
}

.compare-table th {
  background: #eef2ff;
  text-align: center;
  font-weight: 600;
}

.compare-table td {
  text-align: center;
  font-weight: 500;
}

.table-success {
  background-color: rgba(16, 185, 129, 0.15) !important;
}

.table-danger {
  background-color: rgba(239, 68, 68, 0.15) !important;
}

/* =====================
   PRINT STYLES
===================== */
@media print {
  body {
    background: white;
    padding: 0;
    color: black;
    margin: 0;
    gap: 0;
  }
  
  .result-card {
    box-shadow: none;
    background: white;
    color: black;
    max-width: 100%;
    padding: 0;
    border: none;
    margin: 0;
  }
  
  .result-card::before {
    display: none;
  }
  
  .btn,.Official, .mb-3, .mb-4, #compareSection, hr, .header .badge {
    display: none !important;
  }
  
  .marksheet {
    box-shadow: none;
    padding: 0;
    border: 1px solid #ddd;
    margin: 0;
  }
  
  .marksheet::before {
    display: none;
  }
  
  .table {
    box-shadow: none;
  }
}

/* =====================
   LOADING SPINNER
===================== */
.spinner-border {
  width: 3rem;
  height: 3rem;
}

/* =====================
   RESPONSIVE
===================== */
@media (max-width: 576px) {
  .header h3 {
    font-size: 1.9rem;
  }
  
  .info-row {
    gap: 8px;
    padding: 10px;
  }
  
  .info-row span {
    padding: 5px 10px;
    font-size: 12px;
  }
  
  .student-info b {
    min-width: 100px;
  }
}

@media (max-width: 400px) {
  .header h3 {
    font-size: 1.9rem;
  }
  
  .form-control, select {
    padding: 10px 12px;
    font-size: 14px;
  }
  
  .btn-primary, .btn-outline-light, .btn-warning, .btn-success {
    padding: 12px;
  }
}
</style>
</head>

<body>

<div class="container d-flex justify-content-center align-items-center">
  <div class="result-card">
   <br> <!-- ===== HEADER ===== -->
    <div class="header">
      <h3> Akota Kinder Garten <br>Pre-Cadet School</h3>
      <p class="Official">Official Online Result Portal</p>
      <span class="badge badge-academic fs-6">
        <i class="fas fa-calendar-alt"></i> Academic Year 2026
      </span>
    </div>

    <!-- ===== FORM ===== -->
    <div class="mb-4">
      <label class="form-label">
        <i class="fas fa-chalkboard-teacher"></i> Select Class
      </label>
      <select id="classSelect" class="form-control">
        <option value="">-- Select Class --</option>
        <option value="1">Class 1</option>
        <option value="2">Class 2</option>
        <option value="3">Class 3</option>
        <option value="4">Class 4</option>
        <option value="5">Class 5</option>
      </select>
    </div>

    <div class="mb-4">
      <label class="form-label">
        <i class="fas fa-file-alt"></i> Exam Term
      </label>
      <select id="termSelect" class="form-control">
        <option value="">-- Select Term --</option>
        <option value="1st">1st Term</option>
        <option value="2nd">2nd Term</option>
        <option value="Final">Final Exam</option>
      </select>
    </div>

    <div class="mb-4">
      <label class="form-label">
        <i class="fas fa-id-badge"></i> Roll Number
      </label>
      <input type="number" id="rollInput" class="form-control" placeholder="Enter student roll number" min="1">
    </div>

    <!-- ===== CHECK RESULT BUTTON ===== -->
    <button class="btn btn-primary w-100 fw-semibold mb-4" onclick="checkResult()">
      <i class="fas fa-search"></i> Check Result
    </button>

    <!-- ===== RESULT OUTPUT ===== -->
    <div id="result" class="mt-4"></div>
    
    <!-- ===== PRINT BUTTON ===== -->
    <br>
    <button class="btn btn-outline-light w-100 fw-semibold mb-4" onclick="window.print()" id="printBtn" style="display: none;">
      <i class="fas fa-print"></i> Print Result
    </button>

    <hr class="my-4 border-light opacity-25">

    <!-- ===== SHOW/HIDE COMPARE SECTION ===== -->
    <div class="mb-3 text-center">
      <button class="btn btn-warning w-100 fw-semibold" id="showCompareBtn">
        <i class="fas fa-balance-scale"></i> Compare Students
      </button>
    </div>
    
    <!-- ===== COMPARE SECTION (HIDDEN INITIALLY) ===== -->
    <div id="compareSection" style="display:none;">
      <h5 class="text-center mb-4">
        <i class="fas fa-users"></i> Compare Two Students
      </h5>

      <div class="row mb-4">
        <div class="col">
          <input type="number" id="rollCompare1" class="form-control" placeholder="Enter Roll 1" min="1">
        </div>
        <div class="col">
          <input type="number" id="rollCompare2" class="form-control" placeholder="Enter Roll 2" min="1">
        </div>
      </div>

      <div class="mb-3">
        <button class="btn btn-success w-100 fw-semibold" onclick="compareStudents()">
          <i class="fas fa-chart-bar"></i> Compare Students
        </button>
      </div>

      <div id="compareResult" class="mt-3"></div>
    </div>

    <!-- ===== FOOTER ===== -->
    <div class="text-center mt-4 pt-4 border-top border-light opacity-50">
      <small>
        © 2026 • Powered by Mehedi Al Hasan Sawon
      </small>
    </div>
  </div>
</div>

<script>
// Sample data structure - Replace with your actual Google Sheets CSV links
const sheetLinks = {
  1: "https://docs.google.com/spreadsheets/d/e/2PACX-1vRzQfWwhLQUAANvI90FSIrTYe9UWVdamvanJHWhJ0NqFnNsvIhD1mTDBhDT6kaoCHOpJL_Iqlfoe-Ra/pub?gid=0&single=true&output=csv",
  2: "PASTE_CLASS2_CSV_LINK",
  3: "PASTE_CLASS3_CSV_LINK",
  4: "PASTE_CLASS4_CSV_LINK",
  5: "PASTE_CLASS5_CSV_LINK"
};

async function checkResult() {
  const cls = document.getElementById("classSelect").value;
  const term = document.getElementById("termSelect").value;
  const roll = document.getElementById("rollInput").value;
  const resultDiv = document.getElementById("result");
  const printBtn = document.getElementById("printBtn");

  // Clear previous results and hide print button
  resultDiv.innerHTML = '';
  printBtn.style.display = 'none';

  // Validation
  if (!cls || !term || !roll) {
    resultDiv.innerHTML = `<div class="alert alert-danger alert-dismissible fade show">
      <i class="fas fa-exclamation-circle"></i> <strong>Error!</strong> Please fill all the required fields.
      <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>`;
    return;
  }

  if (roll <= 0) {
    resultDiv.innerHTML = `<div class="alert alert-warning">
      <i class="fas fa-exclamation-triangle"></i> Please enter a valid roll number.
    </div>`;
    return;
  }

  // Show loading
  resultDiv.innerHTML = `<div class="text-center">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="text-light mt-3">Fetching result data...</p>
  </div>`;

  try {
    // Fetch data from Google Sheets
    const res = await fetch(sheetLinks[cls]);
    if (!res.ok) throw new Error('Failed to fetch data');
    
    const text = await res.text();
    const rows = text.trim().split("\n").slice(1);

    let studentSubjects = [];
    let studentInfo = null;
    let fail = false;
    let subjectHighest = {};
    let studentTotals = {};
    let studentNames = {};

    // Process each row
    rows.forEach(r => {
      const c = r.split(",");
      if (c.length < 8) return; // Skip invalid rows
      
      const rRoll = c[0].trim();
      const rName = c[1]?.trim() || "N/A";
      const rTerm = c[5].trim();
      const subject = c[6].trim();
      const marks = Number(c[7].trim());

      if (rTerm !== term) return;

      // Store student name
      studentNames[rRoll] = rName;

      // Highest marks calculation
      subjectHighest[subject] = Math.max(subjectHighest[subject] || 0, marks);

      // Total marks calculation
      studentTotals[rRoll] = (studentTotals[rRoll] || 0) + marks;

      // Current student
      if (rRoll == roll) {
        studentInfo = c;
        studentSubjects.push({ subject, marks });
        if (marks < 33) fail = true;
      }
    });

    if (!studentInfo || studentSubjects.length === 0) {
      resultDiv.innerHTML = `<div class="alert alert-warning">
        <i class="fas fa-search"></i> <strong>Not Found!</strong> No result found for Roll ${roll} in ${term} Term.
      </div>`;
      return;
    }

    // Position calculation
    const sortedTotals = Object.entries(studentTotals)
      .sort((a, b) => b[1] - a[1])
      .map(x => x[0]);

    const position = fail ? "--" : sortedTotals.indexOf(roll) + 1;
    const totalMarks = studentSubjects.reduce((s, x) => s + x.marks, 0);
    const totalSubjects = studentSubjects.length;
    const gpaValue = fail ? 0 : (totalMarks / totalSubjects / 20);
    const gpa = fail ? "0.00 (Fail)" : gpaValue.toFixed(2);
    const status = fail ? "Fail" : "Pass";
    const percentage = ((totalMarks / (totalSubjects * 100)) * 100).toFixed(2);
    const highestTotal = Math.max(...Object.values(studentTotals));

    // Find topper
    let topperRoll = null;
    let topperName = "N/A";

    for (const [rRoll, total] of Object.entries(studentTotals)) {
      if (total === highestTotal) {
        topperRoll = rRoll;
        topperName = studentNames[rRoll] || "N/A";
        break;
      }
    }

    // Build table rows
    let tableRows = "";
    studentSubjects.forEach(s => {
      const isFail = s.marks < 33;
      tableRows += `
        <tr>
          <td>${s.subject}</td>
          <td>100</td>
          <td>${subjectHighest[s.subject]}</td>
          <td class="${isFail ? 'text-danger fw-bold' : ''}">
            ${s.marks}${isFail ? ' <span class="badge badge-fail">Fail</span>' : ''}
          </td>
        </tr>`;
    });

    // Display result
    resultDiv.innerHTML = `
    <div class="marksheet">
      <h4> Akota Kinder Garten Pre-Cadet School</h4>
      <h5>Academic Marksheet - 2026</h5>

      <div class="student-info">
        <p><b><i class="fas fa-user"></i> Name:</b> ${studentInfo[1] || 'N/A'}</p>
        <p><b>Father's Name:</b> ${studentInfo[2] || 'N/A'}</p>
        <p><b>Mother's Name:</b> ${studentInfo[3] || 'N/A'}</p>
      </div>

      <div class="info-row">
        <span><b><i class="fas fa-graduation-cap"></i> Class:</b> ${cls}</span>
        <span><b><i class="fas fa-hashtag"></i> Roll:</b> ${roll}</span>
        <span><b><i class="fas fa-calendar"></i> Term:</b> ${term}</span>
        <span class="badge-status ${fail ? 'badge-fail' : 'badge-pass'}">
          <i class="fas fa-${fail ? 'times' : 'check'}"></i> ${status}
        </span>
      </div>
              <p class="badge badge-position">
          <i class="fas fa-trophy"></i> My Position:  ${position}
        </p>
      <div class="info-row">
        <span class="text-success fw-bold">
          <i class="fas fa-crown"></i> Topper: ${topperName} (Roll ${topperRoll})
        </span>
      </div>

      <table class="table table-bordered">
        <thead>
          <tr>
            <th><i class="fas fa-book"></i> Subject</th>
            <th><i class="fas fa-chart-pie"></i> Total</th>
            <th><i class="fas fa-chart-line"></i> Highest</th>
            <th><i class="fas fa-star"></i> Obtained</th>
          </tr>
        </thead>
        <tbody>
          ${tableRows}
        </tbody>
        <tfoot>
          <tr>
            <th><i class="fas fa-calculator"></i> Total</th>
            <th>${totalSubjects * 100}</th>
            <th>${highestTotal}</th>
            <th>${totalMarks}</th>
          </tr>
        </tfoot>
      </table>

      <div class="gpa-row">
        <span class="${fail ? 'gpa-fail' : 'gpa-pass'}">
          <i class="fas fa-chart-bar"></i> <b>GPA:</b> ${gpa}
        </span>
        <span class="text-primary">
          <i class="fas fa-percentage"></i> <b>Percentage:</b> ${percentage}%
        </span>
      </div>

      <div class="footer-row">
        <span><i class="fas fa-calendar-day"></i> <b>Date:</b> ${new Date().toLocaleDateString('en-GB', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}     <i class="fas fa-check-circle text-success"></i>
      </div> </span>
    </div>`;

    // Show print button
    printBtn.style.display = 'block';

  } catch (error) {
    console.error('Error:', error);
    resultDiv.innerHTML = `<div class="alert alert-danger">
      <i class="fas fa-exclamation-triangle"></i> <strong>Error!</strong> Failed to load results. Please check your connection or contact support.
      <br><small class="opacity-75">${error.message}</small>
    </div>`;
  }
}

async function compareStudents() {
  const cls = document.getElementById("classSelect").value;
  const term = document.getElementById("termSelect").value;
  const roll1 = document.getElementById("rollCompare1").value;
  const roll2 = document.getElementById("rollCompare2").value;
  const compareDiv = document.getElementById("compareResult");

  // Validation
  if (!cls || !term || !roll1 || !roll2) {
    compareDiv.innerHTML = `<div class="alert alert-danger">
      <i class="fas fa-exclamation-circle"></i> Please fill all fields for comparison. [Select Class and Exam Term]
    </div>`;
    return;
  }

  if (roll1 === roll2) {
    compareDiv.innerHTML = `<div class="alert alert-warning">
      <i class="fas fa-info-circle"></i> Please enter two different roll numbers
    </div>`;
    return;
  }

  compareDiv.innerHTML = `<div class="text-center">
    <div class="spinner-border text-success" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="text-light mt-2">Comparing students...</p>
  </div>`;

  try {
    const res = await fetch(sheetLinks[cls]);
    if (!res.ok) throw new Error('Failed to fetch data');
    
    const text = await res.text();
    const rows = text.trim().split("\n").slice(1);

    let student1 = { info: {}, marks: {} };
    let student2 = { info: {}, marks: {} };
    let subjectsSet = new Set();
    let studentTotals = {};

    rows.forEach(r => {
      const c = r.split(",");
      if (c.length < 8 || c[5].trim() !== term) return;
      
      const roll = c[0].trim();
      const subject = c[6].trim();
      const marks = Number(c[7].trim());
      
      subjectsSet.add(subject);

      // Calculate totals for position
      studentTotals[roll] = (studentTotals[roll] || 0) + marks;

      if (roll == roll1) {
        student1.info = c;
        student1.marks[subject] = marks;
      }
      if (roll == roll2) {
        student2.info = c;
        student2.marks[subject] = marks;
      }
    });

    if (!Object.keys(student1.marks).length || !Object.keys(student2.marks).length) {
      compareDiv.innerHTML = `<div class="alert alert-warning">
        <i class="fas fa-search"></i> One or both students not found
      </div>`;
      return;
    }

    // Calculate positions
    const sortedTotals = Object.entries(studentTotals)
      .sort((a, b) => b[1] - a[1])
      .map(x => x[0]);

    const position1 = sortedTotals.indexOf(roll1) + 1;
    const position2 = sortedTotals.indexOf(roll2) + 1;

    // Build comparison table
    let tableRows = "";
    let total1 = 0;
    let total2 = 0;

    subjectsSet.forEach(sub => {
      const m1 = student1.marks[sub] || 0;
      const m2 = student2.marks[sub] || 0;
      total1 += m1;
      total2 += m2;

      let s1Class = m1 > m2 ? "table-success" : m1 < m2 ? "table-danger" : "";
      let s2Class = m2 > m1 ? "table-success" : m2 < m1 ? "table-danger" : "";

      tableRows += `
        <tr>
          <td>${sub}</td>
          <td class="${s1Class}">${m1}</td>
          <td class="${s2Class}">${m2}</td>
        </tr>`;
    });

    // Determine winner
    let winnerText = "";
    let winnerClass = "";
    
    if (total1 > total2) {
      winnerText = `<span class="badge bg-success p-2"><i class="fas fa-trophy"></i> Roll ${roll1} Wins!</span>`;
      winnerClass = "text-success";
    } else if (total2 > total1) {
      winnerText = `<span class="badge bg-success p-2"><i class="fas fa-trophy"></i> Roll ${roll2} Wins!</span>`;
      winnerClass = "text-success";
    } else {
      winnerText = `<span class="badge bg-info p-2"><i class="fas fa-handshake"></i> It's a Tie!</span>`;
      winnerClass = "text-info";
    }

    compareDiv.innerHTML = `
    <div class="compare-card">
      <h6 class="text-center mb-3"><i class="fas fa-balance-scale-left"></i> Student Comparison Result</h6>
      
      <div class="text-center mb-4 ${winnerClass}">
        ${winnerText}
      </div>
      
      <div class="row mb-4">
        <div class="col text-center">
          <div class="p-3 bg-light rounded">
            <strong class="d-block">Roll ${roll1}:</strong>
            <span class="text-primary fw-bold">${student1.info[1] || 'N/A'}</span><br>
            <span class="text-dark"><i class="fas fa-chart-line"></i> Total: ${total1}</span><br>
            <span class="text-warning"><i class="fas fa-medal"></i> Position: ${position1}</span>
          </div>
        </div>
        
        <div class="col text-center">
          <div class="p-3 bg-light rounded">
            <strong class="d-block">Roll ${roll2}:</strong>
            <span class="text-primary fw-bold">${student2.info[1] || 'N/A'}</span><br>
            <span class="text-dark"><i class="fas fa-chart-line"></i> Total: ${total2}</span><br>
            <span class="text-warning"><i class="fas fa-medal"></i> Position: ${position2}</span>
          </div>
        </div>
      </div>

      <table class="table table-bordered compare-table">
        <thead>
          <tr>
            <th><i class="fas fa-book"></i> Subject</th>
            <th><i class="fas fa-user"></i> Roll ${roll1}</th>
            <th><i class="fas fa-user"></i> Roll ${roll2}</th>
          </tr>
        </thead>
        <tbody>
          ${tableRows}
          <tr class="table-active fw-bold">
            <th><i class="fas fa-calculator"></i> Total</th>
            <th class="${total1 > total2 ? 'text-success' : total1 < total2 ? 'text-danger' : ''}">${total1}</th>
            <th class="${total2 > total1 ? 'text-success' : total2 < total1 ? 'text-danger' : ''}">${total2}</th>
          </tr>
        </tbody>
      </table>
      
      <div class="text-center mt-3">
        <small class="text-muted">
          <i class="fas fa-info-circle"></i> Green cells indicate higher marks in that subject
        </small>
      </div>
    </div>`;

  } catch (error) {
    console.error('Error:', error);
    compareDiv.innerHTML = `<div class="alert alert-danger">
      <i class="fas fa-exclamation-triangle"></i> Error loading comparison data. Please try again.
    </div>`;
  }
}

// Show/Hide Compare Section
document.getElementById("showCompareBtn").addEventListener("click", function() {
  const section = document.getElementById("compareSection");
  const compareResult = document.getElementById("compareResult");
  
  if (section.style.display === "none") {
    section.style.display = "block";
    this.innerHTML = '<i class="fas fa-times"></i> Hide Compare Section';
    this.classList.remove("btn-warning");
    this.classList.add("btn-danger");
    
    // Scroll to compare section
    section.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
  } else {
    section.style.display = "none";
    this.innerHTML = '<i class="fas fa-balance-scale"></i> Compare Students';
    this.classList.remove("btn-danger");
    this.classList.add("btn-warning");
    compareResult.innerHTML = "";
  }
});

// Add enter key support
document.getElementById("rollInput").addEventListener("keypress", function(e) {
  if (e.key === "Enter") checkResult();
});

document.getElementById("rollCompare2").addEventListener("keypress", function(e) {
  if (e.key === "Enter") compareStudents();
});

// Form validation styling
const inputs = document.querySelectorAll('.form-control');
inputs.forEach(input => {
  input.addEventListener('blur', function() {
    if (this.value.trim() === '') {
      this.style.borderColor = 'rgba(239, 68, 68, 0.5)';
    } else {
      this.style.borderColor = 'rgba(255, 255, 255, 0.15)';
    }
  });
  
  input.addEventListener('focus', function() {
    this.style.borderColor = 'var(--primary)';
  });
});
</script>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
